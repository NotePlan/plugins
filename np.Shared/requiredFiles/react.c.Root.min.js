<<<<<<< HEAD
var RootBundle=function(exports,React$1){"use strict";function _interopDefaultLegacy(e){return e&&typeof e==="object"&&"default"in e?e:{default:e}}var React__default=_interopDefaultLegacy(React$1);var commonjsGlobal=typeof globalThis!=="undefined"?globalThis:typeof window!=="undefined"?window:typeof global!=="undefined"?global:typeof self!=="undefined"?self:{};var reactErrorBoundary_umd={exports:{}};(function(module,exports){(function(global,factory){factory(exports,React__default["default"])})(commonjsGlobal,(function(exports,React){function _interopNamespace(e){if(e&&e.__esModule)return e;var n=Object.create(null);if(e){Object.keys(e).forEach((function(k){if(k!=="default"){var d=Object.getOwnPropertyDescriptor(e,k);Object.defineProperty(n,k,d.get?d:{enumerable:true,get:function(){return e[k]}})}}))}n["default"]=e;return Object.freeze(n)}var React__namespace=_interopNamespace(React);function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _inheritsLoose(subClass,superClass){subClass.prototype=Object.create(superClass.prototype);subClass.prototype.constructor=subClass;_setPrototypeOf(subClass,superClass)}var changedArray=function changedArray(a,b){if(a===void 0){a=[]}if(b===void 0){b=[]}return a.length!==b.length||a.some((function(item,index){return!Object.is(item,b[index])}))};var initialState={error:null};var ErrorBoundary=function(_React$Component){_inheritsLoose(ErrorBoundary,_React$Component);function ErrorBoundary(){var _this;for(var _len=arguments.length,_args=new Array(_len),_key=0;_key<_len;_key++){_args[_key]=arguments[_key]}_this=_React$Component.call.apply(_React$Component,[this].concat(_args))||this;_this.state=initialState;_this.resetErrorBoundary=function(){var _this$props;for(var _len2=arguments.length,args=new Array(_len2),_key2=0;_key2<_len2;_key2++){args[_key2]=arguments[_key2]}_this.props.onReset==null?void 0:(_this$props=_this.props).onReset.apply(_this$props,args);_this.reset()};return _this}ErrorBoundary.getDerivedStateFromError=function getDerivedStateFromError(error){return{error:error}};var _proto=ErrorBoundary.prototype;_proto.reset=function reset(){this.setState(initialState)};_proto.componentDidCatch=function componentDidCatch(error,info){var _this$props$onError,_this$props2;(_this$props$onError=(_this$props2=this.props).onError)==null?void 0:_this$props$onError.call(_this$props2,error,info)};_proto.componentDidUpdate=function componentDidUpdate(prevProps,prevState){var error=this.state.error;var resetKeys=this.props.resetKeys;if(error!==null&&prevState.error!==null&&changedArray(prevProps.resetKeys,resetKeys)){var _this$props$onResetKe,_this$props3;(_this$props$onResetKe=(_this$props3=this.props).onResetKeysChange)==null?void 0:_this$props$onResetKe.call(_this$props3,prevProps.resetKeys,resetKeys);this.reset()}};_proto.render=function render(){var error=this.state.error;var _this$props4=this.props,fallbackRender=_this$props4.fallbackRender,FallbackComponent=_this$props4.FallbackComponent,fallback=_this$props4.fallback;if(error!==null){var _props={error:error,resetErrorBoundary:this.resetErrorBoundary};if(React__namespace.isValidElement(fallback)){return fallback}else if(typeof fallbackRender==="function"){return fallbackRender(_props)}else if(FallbackComponent){return React__namespace.createElement(FallbackComponent,_props)}else{throw new Error("react-error-boundary requires either a fallback, fallbackRender, or FallbackComponent prop")}}return this.props.children};return ErrorBoundary}(React__namespace.Component);function withErrorBoundary(Component,errorBoundaryProps){var Wrapped=function Wrapped(props){return React__namespace.createElement(ErrorBoundary,errorBoundaryProps,React__namespace.createElement(Component,props))};var name=Component.displayName||Component.name||"Unknown";Wrapped.displayName="withErrorBoundary("+name+")";return Wrapped}function useErrorHandler(givenError){var _React$useState=React__namespace.useState(null),error=_React$useState[0],setError=_React$useState[1];if(givenError!=null)throw givenError;if(error!=null)throw error;return setError}exports.ErrorBoundary=ErrorBoundary;exports.useErrorHandler=useErrorHandler;exports.withErrorBoundary=withErrorBoundary;Object.defineProperty(exports,"__esModule",{value:true})}))})(reactErrorBoundary_umd,reactErrorBoundary_umd.exports);function MessageBanner(props){if(!props.warn){return null}console.log(`Root: MessageBanner: props=${JSON.stringify(props)}`);const className=`w3-panel w3-display-container ${props.border?"w3-leftbar":""} ${props.border??"w3-border-red"} ${props.color??"w3-pale-red"}`;window.scrollTo(0,0);return React.createElement("div",{className:className},React.createElement("span",{onClick:()=>props.hide(),className:"w3-button w3-display-right"},"X"),React.createElement("p",null,props.msg))}const ErrorFallback=({error:error,resetErrorBoundary:resetErrorBoundary})=>React.createElement("div",{role:"alert"},React.createElement("h1",null,"Something went wrong in React:"),React.createElement("pre",null,error.message),React.createElement("button",{onClick:resetErrorBoundary},"Try again"));const consoleStyle="background: #222; color: #62AFEC";const logDebug=(msg,...args)=>console.log(`${window.webkit?"":"%c"}${msg}`,consoleStyle,...args);const logSubtle=(msg,...args)=>console.log(`${window.webkit?"":"%c"}${msg}`,"color: #6D6962",...args);const myErrorLogger=(error,info)=>{console.log(`%cRoot: ErrorBoundary got error: error=\n${JSON.stringify(error)},\ninfo=${JSON.stringify(info)}`,"background: #ff0000; color: #ffffff")};const{lastUpdated:lastUpdated=null,returnPluginCommand:returnPluginCommand={},debug:debug=false,ENV_MODE:ENV_MODE}=globalSharedData;if(typeof globalSharedData==="undefined"||!globalSharedData)logDebug("Root: Root: globalSharedData is undefined",globalSharedData);if(typeof globalSharedData==="undefined")throw globalSharedData;if(typeof globalSharedData.lastUpdated==="undefined")throw`Root: globalSharedData.lastUpdated is undefined`;function Root(props){const[npData,setNPData]=React__default["default"].useState(globalSharedData);const[warning,setWarning]=React__default["default"].useState({warn:false,msg:"",color:"w3-pale-red"});const[messageFromPlugin,setMessageFromPlugin]=React__default["default"].useState({});const[history,setHistory]=React__default["default"].useState([lastUpdated]);const tempSavedClicksRef=React__default["default"].useRef([]);const MemoizedWebView=React__default["default"].memo(WebView);debug&&logDebug(`Root: Running in Debug mode. Note: <React.StrictMode> is enabled which will run effects twice each time they are rendered. This is to help find bugs in your code.`);const onClickCapture=e=>{if(!debug)return;logDebug(`Root: onClickCapture: ${e.target.tagName} ${e.target.className}`);logDebug(`Root: onClickCapture ${e.type} ${e.target.outerText} e=`,e);tempSavedClicksRef.current.push({date:(new Date).toLocaleDateString(),msg:`UI_CLICK ${e.type} ${e.target.outerText}`})};const dispatch=(action,data,actionDescriptionForLog="")=>{const desc=`${action}${actionDescriptionForLog?`: ${actionDescriptionForLog}`:""}`;data.lastUpdated={msg:desc,date:(new Date).toLocaleString()};onMessageReceived({data:{type:action,payload:data}})};const shouldIgnoreMessage=event=>{const{origin:origin,source:source,data:data}=event;return typeof data==="string"&&data?.startsWith("setImmediate$")||typeof data==="object"&&data?.hasOwnProperty("iframeSrc")||/react-devtools/.test(data?.source)};const onMessageReceived=event=>{const{data:data}=event;if(!shouldIgnoreMessage(event)&&data){try{const{type:type,payload:payload}=event.data;if(!type)throw`onMessageReceived: event.data.type is undefined`,event.data;if(!payload)throw`onMessageReceived: event.data.payload is undefined`,event.data;if(type&&payload){logDebug(`Root: onMessageReceived: ${type} payload:${JSON.stringify(payload,null,2)}`);if(type==="SHOW_BANNER")payload.lastUpdated.msg+=`: ${payload.msg}`;setHistory((prevData=>[...prevData,...tempSavedClicksRef.current,payload.lastUpdated]));tempSavedClicksRef.current=[];switch(type){case"SET_TITLE":document.title=payload.title;break;case"SET_DATA":case"UPDATE_DATA":setNPData((prevData=>({...prevData,...payload})));globalSharedData={...globalSharedData,...payload};logDebug("Root: SET_DATA after setting globalSharedData=",globalSharedData);break;case"SHOW_BANNER":showBanner(payload.msg,payload.color,payload.border);break;case"SEND_TO_PLUGIN":sendToPlugin(payload);break;case"RETURN_VALUE":logDebug(`Root: onMessageReceived: processing payload`);setMessageFromPlugin(payload);break;default:break}}else{logDebug(`Root: onMessageReceived: called but event.data.type and/or event.data.payload is undefined`,event)}}catch(error){logDebug(`Root: onMessageReceived: error=${JSON.stringify(error)}error=${JSON.stringify(error)}`)}}};const sendToPlugin=React__default["default"].useCallback((args=>{const returnPluginCommand=globalSharedData.returnPluginCommand||"undefined";if(returnPluginCommand==="undefined"||!returnPluginCommand?.command||!returnPluginCommand?.id){throw"returnPluginCommand variable is not passed correctly to set up comms bridge. Check your data object which you are sending to invoke React"}if(!returnPluginCommand?.command)throw"returnPluginCommand.cmd is not defined in the intial data passed to the plugin";if(!returnPluginCommand?.id)throw"returnPluginCommand.id is not defined in the intial data passed to the plugin";const{command:command,id:id}=returnPluginCommand;runPluginCommand(command,id,args)}),[]);const showBanner=(msg,color="w3-pale-red",border="w3-border-red")=>{const warnObj={warn:true,msg:msg,color:color,border:border};logDebug(`Root: showBanner: sending: ${JSON.stringify(warnObj)}`);setWarning(warnObj)};const hideBanner=()=>{setWarning({warn:false,msg:"",color:"w3-pale-red"})};const testCommsBridge=()=>{logDebug(`Root: _Root: testCommsBridge`);sendMessageToPlugin(["commsBridgeTest","some sample","data passed"])};function onRender(id,phase,actualDuration,baseDuration,startTime,commitTime,interactions){logSubtle(`\n===================\nPROFILING:${id} phase=${phase} actualDuration=${actualDuration} baseDuration=${baseDuration} startTime=${startTime} commitTime=${commitTime}\n===================\n`)}React$1.useEffect((()=>{window.addEventListener("message",onMessageReceived);return()=>window.removeEventListener("message",onMessageReceived)}),[]);return React__default["default"].createElement(reactErrorBoundary_umd.exports.ErrorBoundary,{FallbackComponent:ErrorFallback,onReset:()=>{},onError:myErrorLogger},React__default["default"].createElement("div",{className:"Root",onClickCapture:onClickCapture},React__default["default"].createElement(MessageBanner,{warn:warning.warn,msg:warning.msg,color:warning.color,border:warning.border,hide:hideBanner}),debug?React__default["default"].createElement(React$1.Profiler,{id:"MemoizedWebView",onRender:onRender},React__default["default"].createElement(MemoizedWebView,{dispatch:dispatch,data:npData})):React__default["default"].createElement(MemoizedWebView,{data:npData,dispatch:dispatch}),debug&&React__default["default"].createElement(React__default["default"].StrictMode,null,React__default["default"].createElement("div",{className:"w3-container w3-red w3-margin-top"},"Debugging Data (Plugin passed debug:true at window open)"),React__default["default"].createElement("div",null,React__default["default"].createElement("span",{id:"debugHistory"},"History (most recent first):"),React__default["default"].createElement("ul",null,history.slice().reverse().map(((h,i)=>React__default["default"].createElement("li",{style:{fontSize:"12px"},key:i},"[",h?.date||"","]: ",h?.msg||"")))),React__default["default"].createElement("div",{className:"monospaceData"},"globalSharedData: ",JSON.stringify(globalSharedData,null,2))),React__default["default"].createElement("div",{className:"w3-button w3-black",onClick:()=>dispatch("SHOW_BANNER",{msg:"Banner test succeeded"},`banner test`)},"Local Banner Display Test"),React__default["default"].createElement("div",{className:"w3-button w3-black",onClick:testCommsBridge},"Test Communication Bridge"))))}exports.Root=Root;Object.defineProperty(exports,"__esModule",{value:true});return exports}({},react);Object.assign(typeof globalThis=="undefined"?this:globalThis,RootBundle);
=======
var RootBundle=function(exports,React$1){"use strict";function _interopDefaultLegacy(e){return e&&typeof e==="object"&&"default"in e?e:{default:e}}var React__default=_interopDefaultLegacy(React$1);const ErrorBoundaryContext=React$1.createContext(null);const initialState={didCatch:false,error:null};class ErrorBoundary extends React$1.Component{constructor(props){super(props);this.resetErrorBoundary=this.resetErrorBoundary.bind(this);this.state=initialState}static getDerivedStateFromError(error){return{didCatch:true,error:error}}resetErrorBoundary(){const{error:error}=this.state;if(error!==null){var _this$props$onReset,_this$props;for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}(_this$props$onReset=(_this$props=this.props).onReset)===null||_this$props$onReset===void 0?void 0:_this$props$onReset.call(_this$props,{args:args,reason:"imperative-api"});this.setState(initialState)}}componentDidCatch(error,info){var _this$props$onError,_this$props2;(_this$props$onError=(_this$props2=this.props).onError)===null||_this$props$onError===void 0?void 0:_this$props$onError.call(_this$props2,error,info)}componentDidUpdate(prevProps,prevState){const{didCatch:didCatch}=this.state;const{resetKeys:resetKeys}=this.props;if(didCatch&&prevState.error!==null&&hasArrayChanged(prevProps.resetKeys,resetKeys)){var _this$props$onReset2,_this$props3;(_this$props$onReset2=(_this$props3=this.props).onReset)===null||_this$props$onReset2===void 0?void 0:_this$props$onReset2.call(_this$props3,{next:resetKeys,prev:prevProps.resetKeys,reason:"keys"});this.setState(initialState)}}render(){const{children:children,fallbackRender:fallbackRender,FallbackComponent:FallbackComponent,fallback:fallback}=this.props;const{didCatch:didCatch,error:error}=this.state;let childToRender=children;if(didCatch){const props={error:error,resetErrorBoundary:this.resetErrorBoundary};if(typeof fallbackRender==="function"){childToRender=fallbackRender(props)}else if(FallbackComponent){childToRender=React$1.createElement(FallbackComponent,props)}else if(fallback===null||React$1.isValidElement(fallback)){childToRender=fallback}else{throw error}}return React$1.createElement(ErrorBoundaryContext.Provider,{value:{didCatch:didCatch,error:error,resetErrorBoundary:this.resetErrorBoundary}},childToRender)}}function hasArrayChanged(){let a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];let b=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];return a.length!==b.length||a.some(((item,index)=>!Object.is(item,b[index])))}function MessageBanner(props){if(!props.warn){return null}console.log(`Root: MessageBanner: props=${JSON.stringify(props)}`);const className=`w3-panel w3-display-container ${props.border?"w3-leftbar":""} ${props.border??"w3-border-red"} ${props.color??"w3-pale-red"}`;window.scrollTo(0,0);return React.createElement("div",{className:className},React.createElement("span",{onClick:()=>props.hide(),className:"w3-button w3-display-right"},"X"),React.createElement("p",null,props.msg))}const PARAM_BLACKLIST=["note","referencedBlocks","availableThemes","currentTheme","linkedNoteTitles","linkedItems"];const dt=()=>{const d=new Date;const pad=value=>value<10?`0${value}`:value.toString();return`${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())} ${d.toLocaleTimeString("en-GB")}`};function JSP(obj,space=2){if(typeof obj!=="object"||obj instanceof Date){return String(obj)}else{if(Array.isArray(obj)){const arrInfo=[];let isValues=false;obj.forEach(((item,i)=>{if(typeof item==="object"){arrInfo.push(`[${i}] = ${JSP(item,space)}`)}else{isValues=true;arrInfo.push(`${item}`)}}));return`${isValues?"[":""}${arrInfo.join(isValues?", ":",\n")}${isValues?"]":""}`}const propNames=getFilteredProps(obj);const fullObj=propNames.reduce(((acc,propName)=>{if(!/^__/.test(propName)){if(Array.isArray(obj[propName])){try{if(PARAM_BLACKLIST.indexOf(propName)===-1){acc[propName]=obj[propName].map((x=>{if(typeof x==="object"&&!(x instanceof Date)){return JSP(x,"")}else{return x}}))}else{acc[propName]=obj[propName]}}catch(error){logDebug$1("helpers/dev",`Caught error in JSP for propname=${propName} : ${error} typeof obj[propName]=${typeof obj[propName]} isArray=${String(Array.isArray(obj[propName]))} len=${obj[propName]?.length} \n VALUE: ${JSON.stringify(obj[propName])}`)}}else{acc[propName]=obj[propName]}}return acc}),{});return typeof fullObj==="object"&&!(fullObj instanceof Date)?JSON.stringify(fullObj,null,space??null):"date"}}function clo(obj,preamble="",space=2){if(!obj){logDebug$1(preamble,`null`);return}if(typeof obj!=="object"){logDebug$1(preamble,`${obj}`)}else{logDebug$1(preamble,JSP(obj,space))}}function getAllPropertyNames(inObj){let obj=inObj;const props=[];do{Object.getOwnPropertyNames(obj).forEach((function(prop){if(props.indexOf(prop)===-1){props.push(prop)}}))}while(obj=Object.getPrototypeOf(obj));return props}const getFilteredProps=object=>{const ignore=["toString","toLocaleString","valueOf","hasOwnProperty","propertyIsEnumerable","isPrototypeOf"];if(typeof object!=="object"||Array.isArray(object)){return[]}return getAllPropertyNames(object).filter((prop=>!/(^__)|(constructor)/.test(prop)&&!ignore.includes(prop)))};const _message=message=>{let logMessage="";switch(typeof message){case"string":logMessage=message;break;case"object":if(Array.isArray(message)){logMessage=message.toString()}else{logMessage=message instanceof Date?message.toString():JSON.stringify(message)}break;default:logMessage=message.toString();break}return logMessage};const LOG_LEVELS=["DEBUG","INFO","WARN","ERROR","none"];const LOG_LEVEL_STRINGS=["| DEBUG |","| INFO  |","ðŸ¥º WARNðŸ¥º","â—ï¸ERRORâ—ï¸","none"];function log(pluginInfo,message="",type="INFO"){const thisMessageLevel=LOG_LEVELS.indexOf(type);const thisIndicator=LOG_LEVEL_STRINGS[thisMessageLevel];let msg="";let pluginId="";let pluginVersion="";const isPluginJson=typeof pluginInfo==="object"&&pluginInfo.hasOwnProperty("plugin.id");if(isPluginJson){pluginId=pluginInfo.hasOwnProperty("plugin.id")?pluginInfo["plugin.id"]:"INVALID_PLUGIN_ID";pluginVersion=pluginInfo.hasOwnProperty("plugin.version")?pluginInfo["plugin.version"]:"INVALID_PLUGIN_VERSION";msg=`${dt().padEnd(19)} ${thisIndicator} ${pluginId} v${pluginVersion} :: ${_message(message)}`}else{if(message.length>0){msg=`${dt().padEnd(19)} ${thisIndicator} ${pluginInfo} :: ${_message(message)}`}else{msg=`${dt().padEnd(19)} ${thisIndicator} ${_message(pluginInfo)}`}}let userLogLevel=1;const pluginSettings=typeof DataStore!=="undefined"?DataStore.settings:null;if(pluginSettings&&pluginSettings.hasOwnProperty("_logLevel")){userLogLevel=pluginSettings["_logLevel"]}const userLogLevelIndex=LOG_LEVELS.indexOf(userLogLevel);if(thisMessageLevel>=userLogLevelIndex){console.log(msg)}return msg}function logDebug$1(pluginInfo,message=""){return log(pluginInfo,message,"DEBUG")}const formatReactError=(error,cs="")=>({name:error.name,message:error.message,inComponent:cs.split("@file",1)[0]?.replace("\n",""),line:error.line||"",column:error.column,componentStack:cs.split("\n").map((s=>s.replace(/\@file.*$/,""))).filter((s=>s.trim()!=="div"&&s.trim()!==""&&s.trim()!=="Root"&&s.trim()!=="ErrorBoundary")).join(" < ")});const ErrorFallback=props=>{clo(props);const{error:error}=props;const formatted=formatReactError(error);return React.createElement("div",{role:"alert"},React.createElement("h1",null,"Something went wrong in React:"),React.createElement("pre",null,formatted.name,": ",formatted.message),React.createElement("p",null),React.createElement("p",null,"See more detail in the console"))};const consoleStyle="background: #222; color: #62AFEC";const logDebug=(msg,...args)=>console.log(`${window.webkit?"":"%c"}${msg}`,consoleStyle,...args);const logSubtle=(msg,...args)=>console.log(`${window.webkit?"":"%c"}${msg}`,"color: #6D6962",...args);const myErrorLogger=(e,i)=>{const error=formatReactError(e,i.componentStack);console.log(`${window.webkit?"":"%c"}React error trapped by Root::ErrorBoundary; error=${JSP(error,2)}`,"background: #ff0000; color: #ffffff")};const{lastUpdated:lastUpdated=null,returnPluginCommand:returnPluginCommand={},debug:debug=false,ENV_MODE:ENV_MODE}=globalSharedData;if(typeof globalSharedData==="undefined"||!globalSharedData)logDebug("Root: Root: globalSharedData is undefined",globalSharedData);if(typeof globalSharedData==="undefined")throw globalSharedData;if(typeof globalSharedData.lastUpdated==="undefined")throw`Root: globalSharedData.lastUpdated is undefined`;function Root(props){const[npData,setNPData]=React__default["default"].useState(globalSharedData);const[warning,setWarning]=React__default["default"].useState({warn:false,msg:"",color:"w3-pale-red"});const[messageFromPlugin,setMessageFromPlugin]=React__default["default"].useState({});const[history,setHistory]=React__default["default"].useState([lastUpdated]);const tempSavedClicksRef=React__default["default"].useRef([]);const MemoizedWebView=React__default["default"].memo(WebView);debug&&logDebug(`Root: Running in Debug mode. Note: <React.StrictMode> is enabled which will run effects twice each time they are rendered. This is to help find bugs in your code.`);const onClickCapture=e=>{if(!debug)return;logDebug(`Root: onClickCapture: ${e.target.tagName} ${e.target.className}`);logDebug(`Root: onClickCapture ${e.type} ${e.target.outerText} e=`,e);tempSavedClicksRef.current.push({date:(new Date).toLocaleDateString(),msg:`UI_CLICK ${e.type} ${e.target.outerText}`})};const dispatch=(action,data,actionDescriptionForLog="")=>{const desc=`${action}${actionDescriptionForLog?`: ${actionDescriptionForLog}`:""}`;data.lastUpdated={msg:desc,date:(new Date).toLocaleString()};onMessageReceived({data:{type:action,payload:data}})};const shouldIgnoreMessage=event=>{const{origin:origin,source:source,data:data}=event;return typeof data==="string"&&data?.startsWith("setImmediate$")||typeof data==="object"&&data?.hasOwnProperty("iframeSrc")||/react-devtools/.test(data?.source)};const onMessageReceived=event=>{const{data:data}=event;if(!shouldIgnoreMessage(event)&&data){try{const{type:type,payload:payload}=event.data;if(!type)throw`onMessageReceived: event.data.type is undefined`,event.data;if(!payload)throw`onMessageReceived: event.data.payload is undefined`,event.data;if(type&&payload){logDebug(`Root: onMessageReceived: ${type} payload:${JSON.stringify(payload,null,2)}`);if(type==="SHOW_BANNER")payload.lastUpdated.msg+=`: ${payload.msg}`;setHistory((prevData=>[...prevData,...tempSavedClicksRef.current,payload.lastUpdated]));tempSavedClicksRef.current=[];switch(type){case"SET_TITLE":document.title=payload.title;break;case"SET_DATA":case"UPDATE_DATA":setNPData((prevData=>({...prevData,...payload})));globalSharedData={...globalSharedData,...payload};logDebug("Root: SET_DATA after setting globalSharedData=",globalSharedData);break;case"SHOW_BANNER":showBanner(payload.msg,payload.color,payload.border);break;case"SEND_TO_PLUGIN":sendToPlugin(payload);break;case"RETURN_VALUE":logDebug(`Root: onMessageReceived: processing payload`);setMessageFromPlugin(payload);break;default:break}}else{logDebug(`Root: onMessageReceived: called but event.data.type and/or event.data.payload is undefined`,event)}}catch(error){logDebug(`Root: onMessageReceived: error=${JSON.stringify(error)}error=${JSON.stringify(error)}`)}}};const sendToPlugin=React__default["default"].useCallback((args=>{const returnPluginCommand=globalSharedData.returnPluginCommand||"undefined";if(returnPluginCommand==="undefined"||!returnPluginCommand?.command||!returnPluginCommand?.id){throw"returnPluginCommand variable is not passed correctly to set up comms bridge. Check your data object which you are sending to invoke React"}if(!returnPluginCommand?.command)throw"returnPluginCommand.cmd is not defined in the intial data passed to the plugin";if(!returnPluginCommand?.id)throw"returnPluginCommand.id is not defined in the intial data passed to the plugin";const{command:command,id:id}=returnPluginCommand;runPluginCommand(command,id,args)}),[]);const showBanner=(msg,color="w3-pale-red",border="w3-border-red")=>{const warnObj={warn:true,msg:msg,color:color,border:border};logDebug(`Root: showBanner: sending: ${JSON.stringify(warnObj)}`);setWarning(warnObj)};const hideBanner=()=>{setWarning({warn:false,msg:"",color:"w3-pale-red"})};const testCommsBridge=()=>{logDebug(`Root: _Root: testCommsBridge`);sendMessageToPlugin(["commsBridgeTest","some sample","data passed"])};function onRender(id,phase,actualDuration,baseDuration,startTime,commitTime,interactions){logSubtle(`\n===================\nPROFILING:${id} phase=${phase} actualDuration=${actualDuration} baseDuration=${baseDuration} startTime=${startTime} commitTime=${commitTime}\n===================\n`)}React$1.useEffect((()=>{window.addEventListener("message",onMessageReceived);return()=>window.removeEventListener("message",onMessageReceived)}),[]);return React__default["default"].createElement(ErrorBoundary,{FallbackComponent:ErrorFallback,onReset:()=>{},onError:myErrorLogger},React__default["default"].createElement("div",{className:"Root",onClickCapture:onClickCapture},React__default["default"].createElement(MessageBanner,{warn:warning.warn,msg:warning.msg,color:warning.color,border:warning.border,hide:hideBanner}),debug?React__default["default"].createElement(React$1.Profiler,{id:"MemoizedWebView",onRender:onRender},React__default["default"].createElement(MemoizedWebView,{dispatch:dispatch,data:npData})):React__default["default"].createElement(MemoizedWebView,{data:npData,dispatch:dispatch}),debug&&React__default["default"].createElement(React__default["default"].StrictMode,null,React__default["default"].createElement("div",{className:"w3-container w3-red w3-margin-top"},"Debugging Data (Plugin passed debug:true at window open)"),React__default["default"].createElement("div",null,React__default["default"].createElement("span",{id:"debugHistory"},"History (most recent first):"),React__default["default"].createElement("ul",null,history.slice().reverse().map(((h,i)=>React__default["default"].createElement("li",{style:{fontSize:"12px"},key:i},"[",h?.date||"","]: ",h?.msg||"")))),React__default["default"].createElement("div",{className:"monospaceData"},"globalSharedData: ",JSON.stringify(globalSharedData,null,2))),React__default["default"].createElement("div",{className:"w3-button w3-black",onClick:()=>dispatch("SHOW_BANNER",{msg:"Banner test succeeded"},`banner test`)},"Local Banner Display Test"),React__default["default"].createElement("div",{className:"w3-button w3-black",onClick:testCommsBridge},"Test Communication Bridge"))))}exports.Root=Root;Object.defineProperty(exports,"__esModule",{value:true});return exports}({},react);Object.assign(typeof globalThis=="undefined"?this:globalThis,RootBundle);
>>>>>>> d2597fdc48c32b87290f89a5c7b3106879e49621
