var WebViewBundle=function(exports,React){"use strict";function _interopDefaultLegacy(e){return e&&typeof e==="object"&&"default"in e?e:{default:e}}var React__default=_interopDefaultLegacy(React);const defaultContextValue={sendActionToPlugin:()=>{},sendToPlugin:()=>{},dispatch:()=>{},pluginData:{},reactSettings:{},setReactSettings:()=>{},updatePluginData:()=>{}};const AppContext=React.createContext(defaultContextValue);const AppProvider=({children:children,sendActionToPlugin:sendActionToPlugin,sendToPlugin:sendToPlugin,dispatch:dispatch,pluginData:pluginData,updatePluginData:updatePluginData,reactSettings:reactSettings,setReactSettings:setReactSettings})=>{const contextValue={sendActionToPlugin:sendActionToPlugin,sendToPlugin:sendToPlugin,dispatch:dispatch,pluginData:pluginData,reactSettings:reactSettings,setReactSettings:setReactSettings,updatePluginData:updatePluginData};return React__default["default"].createElement(AppContext.Provider,{value:contextValue},children)};const PARAM_BLACKLIST=["note","referencedBlocks","availableThemes","currentTheme","linkedNoteTitles","linkedItems"];const dt=()=>{const d=new Date;const pad=value=>value<10?`0${value}`:value.toString();return`${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())} ${d.toLocaleTimeString("en-GB")}`};function JSP(obj,space=2){if(typeof obj!=="object"||obj instanceof Date){return String(obj)}else{if(Array.isArray(obj)){const arrInfo=[];let isValues=false;obj.forEach(((item,i)=>{if(typeof item==="object"){arrInfo.push(`[${i}] = ${JSP(item,space)}`)}else{isValues=true;arrInfo.push(`${item}`)}}));return`${isValues?"[":""}${arrInfo.join(isValues?", ":",\n")}${isValues?"]":""}`}const propNames=getFilteredProps(obj);const fullObj=propNames.reduce(((acc,propName)=>{if(!/^__/.test(propName)){if(Array.isArray(obj[propName])){try{if(PARAM_BLACKLIST.indexOf(propName)===-1){acc[propName]=obj[propName].map((x=>{if(typeof x==="object"&&!(x instanceof Date)){return JSP(x,"")}else{return x}}))}else{acc[propName]=obj[propName]}}catch(error){logDebug$1("helpers/dev",`Caught error in JSP for propname=${propName} : ${error} typeof obj[propName]=${typeof obj[propName]} isArray=${String(Array.isArray(obj[propName]))} len=${obj[propName]?.length} \n VALUE: ${JSON.stringify(obj[propName])}`)}}else{acc[propName]=obj[propName]}}return acc}),{});return typeof fullObj==="object"&&!(fullObj instanceof Date)?JSON.stringify(fullObj,null,space??null):"date"}}function clo(obj,preamble="",space=2){if(!obj){logDebug$1(preamble,`null`);return}if(typeof obj!=="object"){logDebug$1(preamble,`${obj}`)}else{logDebug$1(preamble,JSP(obj,space))}}function getAllPropertyNames(inObj){let obj=inObj;const props=[];do{Object.getOwnPropertyNames(obj).forEach((function(prop){if(props.indexOf(prop)===-1){props.push(prop)}}))}while(obj=Object.getPrototypeOf(obj));return props}const getFilteredProps=object=>{const ignore=["toString","toLocaleString","valueOf","hasOwnProperty","propertyIsEnumerable","isPrototypeOf"];if(typeof object!=="object"||Array.isArray(object)){return[]}return getAllPropertyNames(object).filter((prop=>!/(^__)|(constructor)/.test(prop)&&!ignore.includes(prop)))};const _message=message=>{let logMessage="";switch(typeof message){case"string":logMessage=message;break;case"object":if(Array.isArray(message)){logMessage=message.toString()}else{logMessage=message instanceof Date?message.toString():JSON.stringify(message)}break;default:logMessage=message.toString();break}return logMessage};const LOG_LEVELS=["DEBUG","INFO","WARN","ERROR","none"];const LOG_LEVEL_STRINGS=["| DEBUG |","| INFO  |","ðŸ¥º WARNðŸ¥º","â—ï¸ERRORâ—ï¸","none"];const shouldOutputForLogLevel=logType=>{let userLogLevel=1;const thisMessageLevel=LOG_LEVELS.indexOf(logType);const pluginSettings=typeof DataStore!=="undefined"?DataStore.settings:null;if(pluginSettings&&pluginSettings.hasOwnProperty("_logLevel")){userLogLevel=pluginSettings["_logLevel"]}const userLogLevelIndex=LOG_LEVELS.indexOf(userLogLevel);return thisMessageLevel>=userLogLevelIndex};const shouldOutputForFunctionName=pluginInfo=>{const pluginSettings=typeof DataStore!=="undefined"?DataStore.settings:null;if(pluginSettings&&pluginSettings.hasOwnProperty("_logFunctionRE")){const functionRE=new RegExp(pluginSettings["_logFunctionRE"],"i");const infoStr=pluginInfo==="object"?pluginInfo["plugin.id"]:String(pluginInfo);return functionRE.test(infoStr)}return false};function log$1(pluginInfo,message="",type="INFO"){let msg="";if(shouldOutputForLogLevel(type)||shouldOutputForFunctionName(pluginInfo)){const thisMessageLevel=LOG_LEVELS.indexOf(type);const thisIndicator=LOG_LEVEL_STRINGS[thisMessageLevel];let pluginId="";let pluginVersion="";const isPluginJson=typeof pluginInfo==="object"&&pluginInfo.hasOwnProperty("plugin.id");if(isPluginJson){pluginId=pluginInfo.hasOwnProperty("plugin.id")?pluginInfo["plugin.id"]:"INVALID_PLUGIN_ID";pluginVersion=pluginInfo.hasOwnProperty("plugin.version")?pluginInfo["plugin.version"]:"INVALID_PLUGIN_VERSION";msg=`${dt().padEnd(19)} ${thisIndicator} ${pluginId} v${pluginVersion} :: ${_message(message)}`}else{if(message.length>0){msg=`${dt().padEnd(19)} ${thisIndicator} ${pluginInfo} :: ${_message(message)}`}else{msg=`${dt().padEnd(19)} ${thisIndicator} ${_message(pluginInfo)}`}}console.log(msg)}return msg}function logError(pluginInfo,error){if(typeof error==="object"&&error!=null){const msg=`${error.filename??"<unknown file>"} ${error.lineNumber??"<unkonwn line>"}: ${error.message}`;return log$1(pluginInfo,msg,"ERROR")}return log$1(pluginInfo,error,"ERROR")}function logInfo(pluginInfo,message=""){return log$1(pluginInfo,message,"INFO")}function logDebug$1(pluginInfo,message=""){return log$1(pluginInfo,message,"DEBUG")}function stringToColor(input){let hash=0;for(let i=0;i<input.length;i++){hash=input.charCodeAt(i)+((hash<<5)-hash)}const color=(hash&16777215).toString(16).toUpperCase();const hexColor=`#${`000000${color}`.slice(-6)}`;const rgb=hexToRgb(hexColor);const brightnessAdjusted=adjustBrightness(rgb.r,rgb.g,rgb.b);return`rgb(${brightnessAdjusted.r}, ${brightnessAdjusted.g}, ${brightnessAdjusted.b})`}function hexToRgb(hex){const r=parseInt(hex.slice(1,3),16);const g=parseInt(hex.slice(3,5),16);const b=parseInt(hex.slice(5,7),16);return{r:r,g:g,b:b}}function adjustBrightness(_r,_g,_b){const luminance=.2126*_r+.7152*_g+.0722*_b;const brightnessFactor=luminance<128?.5:.25;const r=Math.floor(Math.min(255,_r+brightnessFactor*255));const g=Math.floor(Math.min(255,_g+brightnessFactor*255));const b=Math.floor(Math.min(255,_b+brightnessFactor*255));return{r:r,g:g,b:b}}const log=(logType,componentName,detail,...args)=>{if(shouldOutputForLogLevel(logType)){const isNotePlanConsole=!!window.webkit;let arg1,arg2;if(isNotePlanConsole){arg1=`${componentName}${detail?`: ${detail} `:""}`;arg2=``;logType==="DEBUG"?logDebug$1(arg1,arg2,...args):logType==="ERROR"?logError(arg1,arg2,...args):logInfo(arg1,arg2,...args)}else{arg1=`%c${componentName}${detail?`: ${detail} `:""}`;arg2=`color: #000; background: ${stringToColor(componentName)}`;console[logType.toLowerCase()](arg1,arg2,...args)}}};const logDebug=(componentName,detail,...args)=>{log("DEBUG",componentName,detail,...args)};function FormView({data:data,dispatch:dispatch,reactSettings:reactSettings,setReactSettings:setReactSettings}){const{pluginData:pluginData,debug:debug}=data;const formFields=pluginData.formFields||[];const closeDialog=()=>{setReactSettings((prev=>({...prev,dynamicDialog:{isOpen:false}})))};const handleCancel=()=>{sendActionToPlugin("onSubmitClick",{type:"cancel"});closeDialog()};const handleSave=formValues=>{clo(formValues,"DynamicDialog: handleSave: formValues");sendActionToPlugin("onSubmitClick",{type:"submit",formValues:formValues,receivingTemplateTitle:pluginData["receivingTemplateTitle"]||""});closeDialog()};const isTrueString=value=>value?/true/i.test(value):false;const openDialog=()=>{setReactSettings((prev=>({...prev,dynamicDialog:{isOpen:true,title:pluginData?.formTitle||"Form Entry",items:formFields,onSave:handleSave,onCancel:handleCancel,allowEmptySubmit:isTrueString(pluginData.allowEmptySubmit),hideDependentItems:isTrueString(pluginData.hideDependentItems)}})))};React.useEffect((()=>{if(data?.passThroughVars?.lastWindowScrollTop!==undefined&&data.passThroughVars.lastWindowScrollTop!==window.scrollY){window.scrollTo(0,data.passThroughVars.lastWindowScrollTop)}}),[data]);React.useEffect((()=>openDialog()),[]);const addPassthroughVars=data=>{const newData={...data};if(!newData.passThroughVars)newData.passThroughVars={};newData.passThroughVars.lastWindowScrollTop=window.scrollY;return newData};const sendActionToPlugin=(command,dataToSend,additionalDetails="")=>{const newData=addPassthroughVars(data);dispatch("UPDATE_DATA",newData);sendToPlugin([command,dataToSend,additionalDetails])};const sendToPlugin=([command,data,additionalDetails=""])=>{if(!command)throw new Error("sendToPlugin: command must be called with a string");logDebug(`Webview: sendToPlugin: ${JSON.stringify(command)} ${additionalDetails}`,command,data,additionalDetails);if(!data)throw new Error("sendToPlugin: data must be called with an object");dispatch("SEND_TO_PLUGIN",[command,data],`WebView: sendToPlugin: ${String(command)} ${additionalDetails}`)};const updatePluginData=(newData,messageForLog)=>{if(!newData){throw new Error("updatePluginData: newData must be called with an object")}if(Object.keys(newData).length<Object.keys(pluginData).length){throw new Error("updatePluginData: newData must be called with an object that has more keys than the current pluginData. You must send a full pluginData object")}const newFullData={...data,pluginData:newData};dispatch("UPDATE_DATA",newFullData,messageForLog)};if(!pluginData.reactSettings)pluginData.reactSettings={};return React__default["default"].createElement(AppProvider,{sendActionToPlugin:sendActionToPlugin,sendToPlugin:sendToPlugin,dispatch:dispatch,pluginData:pluginData,updatePluginData:updatePluginData,reactSettings:reactSettings,setReactSettings:setReactSettings},React__default["default"].createElement("div",{className:`webview ${pluginData.platform||""}`},React__default["default"].createElement("div",{style:{maxWidth:"100vw",width:"100vw"}})))}exports.WebView=FormView;Object.defineProperty(exports,"__esModule",{value:true});return exports}({},react);Object.assign(typeof globalThis=="undefined"?this:globalThis,WebViewBundle);
